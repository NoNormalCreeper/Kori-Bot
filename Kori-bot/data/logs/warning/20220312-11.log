[36mATRI[0m | 03-12 11:20:42 | ERROR plugin.manager >> Failed to import "nonebot_plugin_statistical"
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 19, in run_bot
    module = importlib.import_module(module_name)
             │         │             └ 'bot'
             │         └ <function import_module at 0x7fd957b2b940>
             └ <module 'importlib' from '/usr/local/python3/lib/python3.8/importlib/__init__.py'>
  File "/usr/local/python3/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           │          │           │    │        │        └ 0
           │          │           │    │        └ None
           │          │           │    └ 0
           │          │           └ 'bot'
           │          └ <function _gcd_import at 0x7fd957c59430>
           └ <module 'importlib._bootstrap' (frozen)>
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 783, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed

  File "./bot.py", line 29, in <module>
    nonebot.load_plugins("src/plugins")
    │       └ <function load_plugins at 0x7fd94d83b820>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/plugin/load.py", line 39, in load_plugins
    return manager.load_all_plugins()
           │       └ <function PluginManager.load_all_plugins at 0x7fd94d8363a0>
           └ <nonebot.plugin.manager.PluginManager object at 0x7fd9461b2af0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/plugin/manager.py", line 128, in load_all_plugins
    return set(
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/plugin/manager.py", line 129, in <genexpr>
    filter(None, (self.load_plugin(name) for name in self.list_plugins()))
                  │    │           │         │       │    └ <function PluginManager.list_plugins at 0x7fd94d836280>
                  │    │           │         │       └ <nonebot.plugin.manager.PluginManager object at 0x7fd9461b2af0>
                  │    │           │         └ 'nonebot_plugin_statistical'
                  │    │           └ 'nonebot_plugin_statistical'
                  │    └ <function PluginManager.load_plugin at 0x7fd94d836310>
                  └ <nonebot.plugin.manager.PluginManager object at 0x7fd9461b2af0>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/plugin/manager.py", line 106, in load_plugin
    module = importlib.import_module(
             │         └ <function import_module at 0x7fd957b2b940>
             └ <module 'importlib' from '/usr/local/python3/lib/python3.8/importlib/__init__.py'>
  File "/usr/local/python3/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           │          │           │    │        │        └ 0
           │          │           │    │        └ None
           │          │           │    └ 0
           │          │           └ 'src.plugins.nonebot_plugin_statistical'
           │          └ <function _gcd_import at 0x7fd957c59430>
           └ <module 'importlib._bootstrap' (frozen)>
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/plugin/manager.py", line 194, in exec_module
    super().exec_module(module)
                        └ <module 'src.plugins.nonebot_plugin_statistical' from './src/plugins/nonebot_plugin_statistical/__init__.py'>
  File "<frozen importlib._bootstrap_external>", line 783, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed

  File "./src/plugins/nonebot_plugin_statistical/__init__.py", line 1, in <module>
    from .statistical_hook import *

  File "./src/plugins/nonebot_plugin_statistical/statistical_hook.py", line 7, in <module>
    from .config import save_data, get_prefix_group_count_dict, get_prefix_user_count_dict, \

  File "./src/plugins/nonebot_plugin_statistical/config.py", line 149, in <module>
    plugin2cmd: dict = json.load(f)
                       │    │    └ <_io.TextIOWrapper name='/root/Projects/Kori-Bot/Kori-bot/data/statistical/plugin2cmd.json' mode='r' encoding='utf8'>
                       │    └ <built-in function load>
                       └ <module 'ujson' from '/usr/local/python3/lib/python3.8/site-packages/ujson.cpython-38-x86_64-linux-gnu.so'>

ValueError: Expected object or value
[36mATRI[0m | 03-12 11:20:47 | WARNING nonebot >> Duplicated prefix rule "!lottery"
[36mATRI[0m | 03-12 11:20:47 | WARNING nonebot >> Duplicated prefix rule "！lottery"
[36mATRI[0m | 03-12 11:20:47 | WARNING nonebot >> Duplicated prefix rule "/lottery"
[36mATRI[0m | 03-12 11:21:05 | ERROR nonebot >> Running matcher <Matcher from 老婆, type=message, priority=1, temp=False> failed.
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 153, in _check_matcher
    await _run_matcher(Matcher, bot, event, state, stack, dependency_cache)
          │            │        │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3099' coro=<_event_to_me() done, defined at /usr/local/...
          │            │        │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8d3f340>
          │            │        │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │            │        │    └ GroupMessageEvent(time=1647048014, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
          │            │        └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │            └ <Matcher from 老婆, type=message, priority=1, temp=False>
          └ <function _run_matcher at 0x7fd9468e3700>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 202, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3099' coro=<_event_to_me() done, defined at /usr/local/...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8d3f340>
          │       │   │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │       │   │    └ GroupMessageEvent(time=1647048014, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
          │       │   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │       └ <function Matcher.run at 0x7fd948ae3c10>
          └ <Matcher from 老婆, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 668, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3099' coro=<_event_to_me() done, defined at /usr/local/...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8d3f340>
          │    │          │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │    │          │    └ GroupMessageEvent(time=1647048014, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
          │    │          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │    └ <function Matcher.simple_run at 0x7fd948ae3b80>
          └ <Matcher from 老婆, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 635, in simple_run
    await handler(
          └ <Dependent call=<function _tietie_superuser at 0x7fd932f63790>, params=[ModelField(name='event', type=MessageEvent, required=...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048014, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function _tietie_superuser at 0x7fd932f63790>
                 └ <Dependent call=<function _tietie_superuser at 0x7fd932f63790>, params=[ModelField(name='event', type=MessageEvent, required=...

  File "./src/plugins/wife/__init__.py", line 34, in _tietie_superuser
    await tietie_superuser.finish(Message(result))
          │                │      │       └ [MessageSegment(type='at', data={'qq': '2560359315'}), MessageSegment(type='image', data={'file': 'https://cdn.jsdelivr.net/g...
          │                │      └ <class 'nonebot.adapters.onebot.v11.message.Message'>
          │                └ <classmethod object at 0x7fd948adec40>
          └ <Matcher from 老婆, type=message, priority=1, temp=False>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 464, in finish
    await cls.send(message, **kwargs)
          │   │    │          └ {}
          │   │    └ [MessageSegment(type='at', data={'qq': '2560359315'}), MessageSegment(type='image', data={'file': 'https://cdn.jsdelivr.net/g...
          │   └ <classmethod object at 0x7fd948adebe0>
          └ <Matcher from 老婆, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 449, in send
    return await bot.send(event=event, message=_message, **kwargs)
                 │   │          │              │           └ {}
                 │   │          │              └ [MessageSegment(type='at', data={'qq': '2560359315'}), MessageSegment(type='image', data={'file': 'https://cdn.jsdelivr.net/g...
                 │   │          └ GroupMessageEvent(time=1647048014, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
                 │   └ <function Bot.send at 0x7fd9468e3c10>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 247, in send
    return await self.__class__.send_handler(self, event, message, **kwargs)
                 │    │                      │     │      │          └ {}
                 │    │                      │     │      └ [MessageSegment(type='at', data={'qq': '2560359315'}), MessageSegment(type='image', data={'file': 'https://cdn.jsdelivr.net/g...
                 │    │                      │     └ GroupMessageEvent(time=1647048014, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
                 │    │                      └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                 │    └ <attribute '__class__' of 'object' objects>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 175, in send
    return await bot.send_msg(**params)
                 │              └ {'user_id': 2560359315, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='at', data={'qq': '25...
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 208, in call_api
    return await super().call_api(api, **data)
                                  │      └ {'user_id': 2560359315, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='at', data={'qq': '25...
                                  └ 'send_msg'
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 117, in call_api
    raise exception
          └ <ActionFailed data=None, echo={'seq': 1}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 94, in call_api
    result = await self.adapter._call_api(self, api, **data)
                   │    │       │         │     │      └ {'user_id': 2560359315, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='at', data={'qq': '25...
                   │    │       │         │     └ 'send_msg'
                   │    │       │         └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                   │    │       └ <function Adapter._call_api at 0x7fd9468f1040>
                   │    └ <nonebot.adapters.onebot.v11.adapter.Adapter object at 0x7fd9469d3a30>
                   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/adapter.py", line 107, in _call_api
    return _handle_api_result(
           └ <function _handle_api_result at 0x7fd946977670>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/utils.py", line 81, in _handle_api_result
    raise ActionFailed(**result)
          │              └ {'data': None, 'echo': {'seq': 1}, 'msg': 'SEND_MSG_API_ERROR', 'retcode': 100, 'status': 'failed', 'wording': '请参考 go-cqhttp...
          └ <class 'nonebot.adapters.onebot.v11.exception.ActionFailed'>

nonebot.adapters.onebot.v11.exception.ActionFailed: <ActionFailed data=None, echo={'seq': 1}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
[36mATRI[0m | 03-12 11:21:07 | ERROR nonebot >> Running matcher <Matcher from src.plugins.trigger_memes_from_feiyucans_space, type=message, priority=1, temp=False> failed.
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 153, in _check_matcher
    await _run_matcher(Matcher, bot, event, state, stack, dependency_cache)
          │            │        │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-6165' coro=<_event_to_me() done, defined at /usr/local/...
          │            │        │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d89ee790>
          │            │        │    │      └ {'_prefix': {'command': ('feiyucan',), 'raw_command': '/feiyucan', 'command_arg': [MessageSegment(type='text', data={'text': ...
          │            │        │    └ GroupMessageEvent(time=1647052130, self_id=507346814, post_type='message', sub_type='normal', user_id=1020936395, message_typ...
          │            │        └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │            └ <Matcher from src.plugins.trigger_memes_from_feiyucans_space, type=message, priority=1, temp=False>
          └ <function _run_matcher at 0x7fd9468e3700>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 202, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-6165' coro=<_event_to_me() done, defined at /usr/local/...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d89ee790>
          │       │   │    │      └ {'_prefix': {'command': ('feiyucan',), 'raw_command': '/feiyucan', 'command_arg': [MessageSegment(type='text', data={'text': ...
          │       │   │    └ GroupMessageEvent(time=1647052130, self_id=507346814, post_type='message', sub_type='normal', user_id=1020936395, message_typ...
          │       │   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │       └ <function Matcher.run at 0x7fd948ae3c10>
          └ <Matcher from src.plugins.trigger_memes_from_feiyucans_space, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 668, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-6165' coro=<_event_to_me() done, defined at /usr/local/...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d89ee790>
          │    │          │    │      └ {'_prefix': {'command': ('feiyucan',), 'raw_command': '/feiyucan', 'command_arg': [MessageSegment(type='text', data={'text': ...
          │    │          │    └ GroupMessageEvent(time=1647052130, self_id=507346814, post_type='message', sub_type='normal', user_id=1020936395, message_typ...
          │    │          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │    └ <function Matcher.simple_run at 0x7fd948ae3b80>
          └ <Matcher from src.plugins.trigger_memes_from_feiyucans_space, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 635, in simple_run
    await handler(
          └ <Dependent call=<function handle at 0x7fd925e66040>, params=[ModelField(name='bot', type=Bot, required=True), ModelField(name...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'bot': <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>, 'event': GroupMessageEvent(time=1647052130, self_id=5...
                 │    └ <function handle at 0x7fd925e66040>
                 └ <Dependent call=<function handle at 0x7fd925e66040>, params=[ModelField(name='bot', type=Bot, required=True), ModelField(name...

  File "./src/plugins/trigger_memes_from_feiyucans_space.py", line 48, in handle
    await feiyucan.finish(message=Message(pic_ti))
          │        │              │       └ '#鲱鱼 昨日最佳#\n2022-03-11 15:07:56\nfrom bilibili:鲱鱼罐头app\n[CQ:image,file=https://i0.hdslb.com/bfs/album/02053f225cf50351d01af7b...
          │        │              └ <class 'nonebot.adapters.onebot.v11.message.Message'>
          │        └ <classmethod object at 0x7fd948adec40>
          └ <Matcher from src.plugins.trigger_memes_from_feiyucans_space, type=message, priority=1, temp=False>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 464, in finish
    await cls.send(message, **kwargs)
          │   │    │          └ {}
          │   │    └ [MessageSegment(type='text', data={'text': '#鲱鱼 昨日最佳#\n2022-03-11 15:07:56\nfrom bilibili:鲱鱼罐头app\n'}), MessageSegment(type='...
          │   └ <classmethod object at 0x7fd948adebe0>
          └ <Matcher from src.plugins.trigger_memes_from_feiyucans_space, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 449, in send
    return await bot.send(event=event, message=_message, **kwargs)
                 │   │          │              │           └ {}
                 │   │          │              └ [MessageSegment(type='text', data={'text': '#鲱鱼 昨日最佳#\n2022-03-11 15:07:56\nfrom bilibili:鲱鱼罐头app\n'}), MessageSegment(type='...
                 │   │          └ GroupMessageEvent(time=1647052130, self_id=507346814, post_type='message', sub_type='normal', user_id=1020936395, message_typ...
                 │   └ <function Bot.send at 0x7fd9468e3c10>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 247, in send
    return await self.__class__.send_handler(self, event, message, **kwargs)
                 │    │                      │     │      │          └ {}
                 │    │                      │     │      └ [MessageSegment(type='text', data={'text': '#鲱鱼 昨日最佳#\n2022-03-11 15:07:56\nfrom bilibili:鲱鱼罐头app\n'}), MessageSegment(type='...
                 │    │                      │     └ GroupMessageEvent(time=1647052130, self_id=507346814, post_type='message', sub_type='normal', user_id=1020936395, message_typ...
                 │    │                      └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                 │    └ <attribute '__class__' of 'object' objects>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 175, in send
    return await bot.send_msg(**params)
                 │              └ {'user_id': 1020936395, 'group_id': 277620613, 'message_type': 'group', 'message': [MessageSegment(type='text', data={'text':...
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 208, in call_api
    return await super().call_api(api, **data)
                                  │      └ {'user_id': 1020936395, 'group_id': 277620613, 'message_type': 'group', 'message': [MessageSegment(type='text', data={'text':...
                                  └ 'send_msg'
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 117, in call_api
    raise exception
          └ <ActionFailed data=None, echo={'seq': 7}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 94, in call_api
    result = await self.adapter._call_api(self, api, **data)
                   │    │       │         │     │      └ {'user_id': 1020936395, 'group_id': 277620613, 'message_type': 'group', 'message': [MessageSegment(type='text', data={'text':...
                   │    │       │         │     └ 'send_msg'
                   │    │       │         └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                   │    │       └ <function Adapter._call_api at 0x7fd9468f1040>
                   │    └ <nonebot.adapters.onebot.v11.adapter.Adapter object at 0x7fd9469d3a30>
                   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/adapter.py", line 107, in _call_api
    return _handle_api_result(
           └ <function _handle_api_result at 0x7fd946977670>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/utils.py", line 81, in _handle_api_result
    raise ActionFailed(**result)
          │              └ {'data': None, 'echo': {'seq': 7}, 'msg': 'SEND_MSG_API_ERROR', 'retcode': 100, 'status': 'failed', 'wording': '请参考 go-cqhttp...
          └ <class 'nonebot.adapters.onebot.v11.exception.ActionFailed'>

nonebot.adapters.onebot.v11.exception.ActionFailed: <ActionFailed data=None, echo={'seq': 7}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
[36mATRI[0m | 03-12 11:21:10 | ERROR nonebot >> Running matcher <Matcher from src.plugins.nonebot_plugin_morning, type=message, priority=11, temp=False> failed.
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 153, in _check_matcher
    await _run_matcher(Matcher, bot, event, state, stack, dependency_cache)
          │            │        │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-6183' coro=<_event_to_me() done, defined at /usr/local/...
          │            │        │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8c0a880>
          │            │        │    │      └ {'_prefix': {'command': ('早',), 'raw_command': '!早', 'command_arg': []}}
          │            │        │    └ GroupMessageEvent(time=1647052322, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, message_typ...
          │            │        └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │            └ <Matcher from src.plugins.nonebot_plugin_morning, type=message, priority=11, temp=False>
          └ <function _run_matcher at 0x7fd9468e3700>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 202, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-6183' coro=<_event_to_me() done, defined at /usr/local/...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8c0a880>
          │       │   │    │      └ {'_prefix': {'command': ('早',), 'raw_command': '!早', 'command_arg': []}}
          │       │   │    └ GroupMessageEvent(time=1647052322, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, message_typ...
          │       │   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │       └ <function Matcher.run at 0x7fd948ae3c10>
          └ <Matcher from src.plugins.nonebot_plugin_morning, type=message, priority=11, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 668, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-6183' coro=<_event_to_me() done, defined at /usr/local/...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8c0a880>
          │    │          │    │      └ {'_prefix': {'command': ('早',), 'raw_command': '!早', 'command_arg': []}}
          │    │          │    └ GroupMessageEvent(time=1647052322, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, message_typ...
          │    │          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │    └ <function Matcher.simple_run at 0x7fd948ae3b80>
          └ <Matcher from src.plugins.nonebot_plugin_morning, type=message, priority=11, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 635, in simple_run
    await handler(
          └ <Dependent call=<function good_morning at 0x7fd925e66ee0>, params=[ModelField(name='bot', type=Bot, required=True), ModelFiel...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'bot': <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>, 'event': GroupMessageEvent(time=1647052322, self_id=5...
                 │    └ <function good_morning at 0x7fd925e66ee0>
                 └ <Dependent call=<function good_morning at 0x7fd925e66ee0>, params=[ModelField(name='bot', type=Bot, required=True), ModelFiel...

  File "./src/plugins/nonebot_plugin_morning/__init__.py", line 61, in good_morning
    await morning.finish(message=msg, at_sender=True)
          │       │              └ '早安成功！你的睡眠时长为11时18分5秒，\n你是今天第3个起床的少女！'
          │       └ <classmethod object at 0x7fd948adec40>
          └ <Matcher from src.plugins.nonebot_plugin_morning, type=message, priority=11, temp=False>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 464, in finish
    await cls.send(message, **kwargs)
          │   │    │          └ {'at_sender': True}
          │   │    └ '早安成功！你的睡眠时长为11时18分5秒，\n你是今天第3个起床的少女！'
          │   └ <classmethod object at 0x7fd948adebe0>
          └ <Matcher from src.plugins.nonebot_plugin_morning, type=message, priority=11, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 449, in send
    return await bot.send(event=event, message=_message, **kwargs)
                 │   │          │              │           └ {'at_sender': True}
                 │   │          │              └ '早安成功！你的睡眠时长为11时18分5秒，\n你是今天第3个起床的少女！'
                 │   │          └ GroupMessageEvent(time=1647052322, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, message_typ...
                 │   └ <function Bot.send at 0x7fd9468e3c10>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 247, in send
    return await self.__class__.send_handler(self, event, message, **kwargs)
                 │    │                      │     │      │          └ {'at_sender': True}
                 │    │                      │     │      └ '早安成功！你的睡眠时长为11时18分5秒，\n你是今天第3个起床的少女！'
                 │    │                      │     └ GroupMessageEvent(time=1647052322, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, message_typ...
                 │    │                      └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                 │    └ <attribute '__class__' of 'object' objects>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 175, in send
    return await bot.send_msg(**params)
                 │              └ {'user_id': 1617678696, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='at', data={'qq': '16...
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 208, in call_api
    return await super().call_api(api, **data)
                                  │      └ {'user_id': 1617678696, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='at', data={'qq': '16...
                                  └ 'send_msg'
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 117, in call_api
    raise exception
          └ <ActionFailed data=None, echo={'seq': 12}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 94, in call_api
    result = await self.adapter._call_api(self, api, **data)
                   │    │       │         │     │      └ {'user_id': 1617678696, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='at', data={'qq': '16...
                   │    │       │         │     └ 'send_msg'
                   │    │       │         └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                   │    │       └ <function Adapter._call_api at 0x7fd9468f1040>
                   │    └ <nonebot.adapters.onebot.v11.adapter.Adapter object at 0x7fd9469d3a30>
                   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/adapter.py", line 107, in _call_api
    return _handle_api_result(
           └ <function _handle_api_result at 0x7fd946977670>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/utils.py", line 81, in _handle_api_result
    raise ActionFailed(**result)
          │              └ {'data': None, 'echo': {'seq': 12}, 'msg': 'SEND_MSG_API_ERROR', 'retcode': 100, 'status': 'failed', 'wording': '请参考 go-cqhtt...
          └ <class 'nonebot.adapters.onebot.v11.exception.ActionFailed'>

nonebot.adapters.onebot.v11.exception.ActionFailed: <ActionFailed data=None, echo={'seq': 12}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
[36mATRI[0m | 03-12 11:21:11 | ERROR nonebot >> Running matcher <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False> failed.
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 153, in _check_matcher
    await _run_matcher(Matcher, bot, event, state, stack, dependency_cache)
          │            │        │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3150' coro=<_event_to_me() done, defined at /usr/local/...
          │            │        │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8da8affa0>
          │            │        │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │            │        │    └ GroupMessageEvent(time=1647048590, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │            │        └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │            └ <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False>
          └ <function _run_matcher at 0x7fd9468e3700>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 202, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3150' coro=<_event_to_me() done, defined at /usr/local/...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8da8affa0>
          │       │   │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │       │   │    └ GroupMessageEvent(time=1647048590, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │       │   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │       └ <function Matcher.run at 0x7fd948ae3c10>
          └ <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 668, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3150' coro=<_event_to_me() done, defined at /usr/local/...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8da8affa0>
          │    │          │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │    │          │    └ GroupMessageEvent(time=1647048590, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │    │          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │    └ <function Matcher.simple_run at 0x7fd948ae3b80>
          └ <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 635, in simple_run
    await handler(
          └ <Dependent call=<function repeater at 0x7fd93143fdc0>, params=[ModelField(name='bot', type=Bot, required=True), ModelField(na...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'bot': <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>, 'event': GroupMessageEvent(time=1647048590, self_id=5...
                 │    └ <function repeater at 0x7fd93143fdc0>
                 └ <Dependent call=<function repeater at 0x7fd93143fdc0>, params=[ModelField(name='bot', type=Bot, required=True), ModelField(na...

  File "./src/plugins/nonebot_plugin_repeater/__init__.py", line 66, in repeater
    await bot.send(event, data)
          │   │    │      └ MessageSegment(type='image', data={'file': 'https://gchat.qpic.cn/gchatpic_new/963046537/937760225-3157374596-0379636BDDB0022...
          │   │    └ GroupMessageEvent(time=1647048590, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │   └ <function Bot.send at 0x7fd9468e3c10>
          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 247, in send
    return await self.__class__.send_handler(self, event, message, **kwargs)
                 │    │                      │     │      │          └ {}
                 │    │                      │     │      └ MessageSegment(type='image', data={'file': 'https://gchat.qpic.cn/gchatpic_new/963046537/937760225-3157374596-0379636BDDB0022...
                 │    │                      │     └ GroupMessageEvent(time=1647048590, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
                 │    │                      └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                 │    └ <attribute '__class__' of 'object' objects>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 175, in send
    return await bot.send_msg(**params)
                 │              └ {'user_id': 963046537, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='image', data={'file':...
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 208, in call_api
    return await super().call_api(api, **data)
                                  │      └ {'user_id': 963046537, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='image', data={'file':...
                                  └ 'send_msg'
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 117, in call_api
    raise exception
          └ <ActionFailed data=None, echo={'seq': 10}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 94, in call_api
    result = await self.adapter._call_api(self, api, **data)
                   │    │       │         │     │      └ {'user_id': 963046537, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='image', data={'file':...
                   │    │       │         │     └ 'send_msg'
                   │    │       │         └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                   │    │       └ <function Adapter._call_api at 0x7fd9468f1040>
                   │    └ <nonebot.adapters.onebot.v11.adapter.Adapter object at 0x7fd9469d3a30>
                   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/adapter.py", line 107, in _call_api
    return _handle_api_result(
           └ <function _handle_api_result at 0x7fd946977670>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/utils.py", line 81, in _handle_api_result
    raise ActionFailed(**result)
          │              └ {'data': None, 'echo': {'seq': 10}, 'msg': 'SEND_MSG_API_ERROR', 'retcode': 100, 'status': 'failed', 'wording': '请参考 go-cqhtt...
          └ <class 'nonebot.adapters.onebot.v11.exception.ActionFailed'>

nonebot.adapters.onebot.v11.exception.ActionFailed: <ActionFailed data=None, echo={'seq': 10}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
[36mATRI[0m | 03-12 11:21:11 | ERROR nonebot >> Running matcher <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False> failed.
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 153, in _check_matcher
    await _run_matcher(Matcher, bot, event, state, stack, dependency_cache)
          │            │        │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3096' coro=<_event_to_me() done, defined at /usr/local/...
          │            │        │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8db28e0>
          │            │        │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │            │        │    └ GroupMessageEvent(time=1647047972, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │            │        └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │            └ <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False>
          └ <function _run_matcher at 0x7fd9468e3700>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 202, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3096' coro=<_event_to_me() done, defined at /usr/local/...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8db28e0>
          │       │   │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │       │   │    └ GroupMessageEvent(time=1647047972, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │       │   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │       └ <function Matcher.run at 0x7fd948ae3c10>
          └ <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 668, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-3096' coro=<_event_to_me() done, defined at /usr/local/...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8db28e0>
          │    │          │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None}}
          │    │          │    └ GroupMessageEvent(time=1647047972, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │    │          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │    └ <function Matcher.simple_run at 0x7fd948ae3b80>
          └ <Matcher from src.plugins.nonebot_plugin_repeater, type=message, priority=10, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 635, in simple_run
    await handler(
          └ <Dependent call=<function repeater at 0x7fd93143fdc0>, params=[ModelField(name='bot', type=Bot, required=True), ModelField(na...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'bot': <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>, 'event': GroupMessageEvent(time=1647047972, self_id=5...
                 │    └ <function repeater at 0x7fd93143fdc0>
                 └ <Dependent call=<function repeater at 0x7fd93143fdc0>, params=[ModelField(name='bot', type=Bot, required=True), ModelField(na...

  File "./src/plugins/nonebot_plugin_repeater/__init__.py", line 66, in repeater
    await bot.send(event, data)
          │   │    │      └ MessageSegment(type='image', data={'file': 'https://gchat.qpic.cn/gchatpic_new/963046537/937760225-2679133325-4E994F1332634EB...
          │   │    └ GroupMessageEvent(time=1647047972, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
          │   └ <function Bot.send at 0x7fd9468e3c10>
          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 247, in send
    return await self.__class__.send_handler(self, event, message, **kwargs)
                 │    │                      │     │      │          └ {}
                 │    │                      │     │      └ MessageSegment(type='image', data={'file': 'https://gchat.qpic.cn/gchatpic_new/963046537/937760225-2679133325-4E994F1332634EB...
                 │    │                      │     └ GroupMessageEvent(time=1647047972, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, message_type...
                 │    │                      └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                 │    └ <attribute '__class__' of 'object' objects>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 175, in send
    return await bot.send_msg(**params)
                 │              └ {'user_id': 963046537, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='image', data={'file':...
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 208, in call_api
    return await super().call_api(api, **data)
                                  │      └ {'user_id': 963046537, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='image', data={'file':...
                                  └ 'send_msg'
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 117, in call_api
    raise exception
          └ <ActionFailed data=None, echo={'seq': 11}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 94, in call_api
    result = await self.adapter._call_api(self, api, **data)
                   │    │       │         │     │      └ {'user_id': 963046537, 'group_id': 937760225, 'message_type': 'group', 'message': [MessageSegment(type='image', data={'file':...
                   │    │       │         │     └ 'send_msg'
                   │    │       │         └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                   │    │       └ <function Adapter._call_api at 0x7fd9468f1040>
                   │    └ <nonebot.adapters.onebot.v11.adapter.Adapter object at 0x7fd9469d3a30>
                   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/adapter.py", line 107, in _call_api
    return _handle_api_result(
           └ <function _handle_api_result at 0x7fd946977670>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/utils.py", line 81, in _handle_api_result
    raise ActionFailed(**result)
          │              └ {'data': None, 'echo': {'seq': 11}, 'msg': 'SEND_MSG_API_ERROR', 'retcode': 100, 'status': 'failed', 'wording': '请参考 go-cqhtt...
          └ <class 'nonebot.adapters.onebot.v11.exception.ActionFailed'>

nonebot.adapters.onebot.v11.exception.ActionFailed: <ActionFailed data=None, echo={'seq': 11}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
[36mATRI[0m | 03-12 11:21:11 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8acce40>
           └ <_AsyncIoGreenlet object at 0x7fd8d82937d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d842c2c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d85947a0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d85947a0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-42, stopped daemon 140568164198144)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef4e0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8872440>, <coroutine object _run_coro_with_catch at 0x7fd8d8596040>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8872840>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048669, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0e7af40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d821c940>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0e7af40>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d82937d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d821c940>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d821c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d821c3d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d821c3d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d821c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d821cb50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d821c8b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d821c8b0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 31, 9, tzinfo=datetime.timezone.utc), 'platform': 'qq', '...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d833c5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8acce40>
           └ <_AsyncIoGreenlet object at 0x7fd8d82937d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d842c2c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d85947a0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d85947a0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-42, stopped daemon 140568164198144)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d0f08df0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef4e0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:31:09.000000', 'message', 'group', '555612706', '[{"type": "text", "data": {"text": "完了完了"}}]', '完了完了', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88d49c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8558d50 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d842cac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89782d0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89782d0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-27, started daemon 140568290088704)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d65d0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8d4e3c0>, <coroutine object _run_coro_with_catch at 0x7fd8d8d4e440>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8d4eac0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048169, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8638f10>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8638ee0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8638f10>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8558d50 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8638ee0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8638ee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8638850>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8638850>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8638ee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8638640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8638ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8638ac0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 22, 49, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d158c6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88d49c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8558d50 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d842cac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89782d0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89782d0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-27, started daemon 140568290088704)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d65d0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:22:49.000000', 'message', 'group', '521357936', '[{"type": "text", "data": {"text": "高中三年不谈恋爱家人们"}}]', '高中三年不谈恋爱家人们', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8B...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8B...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88d4740>
           └ <_AsyncIoGreenlet object at 0x7fd8d81a2b40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468a40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8B...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8978340>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8978340>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-15, stopped daemon 140568466269952)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b990>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8872e40>, <coroutine object _run_coro_with_catch at 0x7fd8d8cf2dc0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8d9c940>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647047963, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d885d2e0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d885d370>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d885d2e0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d81a2b40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d885d370>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d885d370>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d885d7c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d885d7c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d885d370>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d885d640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d885df70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d885df70>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 19, 23, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d885d970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8B...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8B...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88d4740>
           └ <_AsyncIoGreenlet object at 0x7fd8d81a2b40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468a40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8B...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8978340>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8978340>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-15, stopped daemon 140568466269952)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3c10>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b990>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:19:23.000000', 'message', 'group', '101219121', '[{"type": "forward", "data": {"id": "WXbjQYsR0zNNqgr8BDS8M0b5ueDhOtW4zh8vnXprzIoy3Vj7SjknU7G7si42GlHK"}}]', '', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8cc0cc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d1587e00 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d84680c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89783b0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89783b0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-11, stopped daemon 140568499840768)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b5d0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8aaf8c0>, <coroutine object _run_coro_with_catch at 0x7fd8d8aaf6c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8d87f40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647046250, self_id=507346814, post_type='message', sub_type='normal', user_id=1756449233, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d841b8b0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d841be20>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d841b8b0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d1587e00 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d841be20>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d841be20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d841bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d841bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d841be20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d841baf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d841beb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d841beb0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1756449233', 'time': datetime.datetime(2022, 3, 12, 0, 50, 50, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d841b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8cc0cc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d1587e00 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d84680c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89783b0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89783b0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-11, stopped daemon 140568499840768)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3640>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b5d0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 00:50:50.000000', 'message', 'group', '-166386731', '[{"type": "text", "data": {"text": "请问树莓派能接啥样的电磁锁啊？"}}]', '请问树莓派能接啥样的电磁锁啊？', '1756449233', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdad00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdad00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdad00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80d1040>
           └ <_AsyncIoGreenlet object at 0x7fd8d8ac7720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468940>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594490>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594490>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-30, stopped daemon 140568264910592)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d67b0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8596cc0>, <coroutine object _run_coro_with_catch at 0x7fd8d85966c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8596740>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048191, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8241880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8241940>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8241880>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8ac7720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8241940>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8241940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84ac040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84ac040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8241940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84acd60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84ac5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84ac5e0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 23, 11, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84acd90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdad00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdad00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdad00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80d1040>
           └ <_AsyncIoGreenlet object at 0x7fd8d8ac7720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468940>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594490>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594490>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-30, stopped daemon 140568264910592)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552160>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d67b0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:23:11.000000', 'message', 'group', '-2045109302', '[{"type": "text", "data": {"text": "啊对对对"}}]', '啊对对对', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b812e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b812e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b812e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88e8b40>
           └ <_AsyncIoGreenlet object at 0x7fd8d8da6930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d84685c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8bab730>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8bab730>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-7, stopped daemon 140568743098112)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b210>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fb9ec0>, <coroutine object _run_coro_with_catch at 0x7fd8d8319740>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8da6740c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647044048, self_id=507346814, post_type='message', sub_type='normal', user_id=594352301, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83031c0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8201fa0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83031c0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8da6930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8201fa0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8201fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84e47f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84e47f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8201fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84e4430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84e4280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84e4280>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '594352301', 'time': datetime.datetime(2022, 3, 12, 0, 14, 8, tzinfo=datetime.timezone.utc), 'platform': 'qq', '...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84e4070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b812e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b812e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b812e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88e8b40>
           └ <_AsyncIoGreenlet object at 0x7fd8d8da6930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d84685c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8bab730>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8bab730>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-7, stopped daemon 140568743098112)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83a6be0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b210>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 00:14:08.000000', 'message', 'group', '-6066178', '[{"type": "text", "data": {"text": "代码"}}]', '代码', '594352301', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '96...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdae80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdae80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '96...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdae80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80b7ac0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8c877d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8ae9c40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '96...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594570>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594570>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-36, stopped daemon 140568214554368)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d6e40>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8a74b40>, <coroutine object _run_coro_with_catch at 0x7fd8d8a74840>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8a740c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048575, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8909430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8909f70>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8909430>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8c877d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8909f70>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8909f70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8909610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8909610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8909f70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88a61c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88a6880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88a6880>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 29, 35, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88a66d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '96...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdae80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdae80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '96...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdae80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80b7ac0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8c877d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8ae9c40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '96...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594570>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594570>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-36, stopped daemon 140568214554368)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8552670>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d6e40>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:29:35.000000', 'message', 'group', '-2122850349', '[{"type": "text", "data": {"text": "。"}}]', '。', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10293c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d17b3510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468240>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d82ecf80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d82ecf80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-20, stopped daemon 140568348837632)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5be40>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8877640>, <coroutine object _run_coro_with_catch at 0x7fd8d8cf28c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8cf27c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048050, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d847dc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d847d910>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d847dc40>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d17b3510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d847d910>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d847d910>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d16a18b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d16a18b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d847d910>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d16a19d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d16a1160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d16a1160>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 20, 50, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16a1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10293c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d17b3510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468240>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d82ecf80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d82ecf80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-20, stopped daemon 140568348837632)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d162bb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5be40>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:20:50.000000', 'message', 'group', '23445288', '[{"type": "text", "data": {"text": "完了家人们"}}]', '完了家人们', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdac40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdac40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdac40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80d15c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d856d880 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8ae9540>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594420>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594420>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-32, stopped daemon 140568248125184)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d6b70>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d85963c0>, <coroutine object _run_coro_with_catch at 0x7fd8d8596840>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8596240>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048197, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8544cd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8544a90>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8544cd0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d856d880 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8544a90>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8544a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8544100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8544100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8544a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d1622d60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1622850>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1622850>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 23, 17, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1622dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdac40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdac40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdac40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80d15c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d856d880 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8ae9540>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594420>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594420>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-32, stopped daemon 140568248125184)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d6220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d6b70>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:23:17.000000', 'message', 'group', '410947177', '[{"type": "text", "data": {"text": "对对对"}}]', '对对对', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d15b9f40>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f4db40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d842cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d85940a0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d85940a0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-44, stopped daemon 140568147412736)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef6c0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8596ec0>, <coroutine object _run_coro_with_catch at 0x7fd8d8596540>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d85961c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048685, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88c8640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d88c8ca0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88c8640>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f4db40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d88c8ca0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88c8ca0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88c8040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88c8040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88c8ca0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d176e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d176ef10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d176ef10>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 31, 25, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176e2b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bda640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d15b9f40>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f4db40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d842cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d85940a0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d85940a0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-44, stopped daemon 140568147412736)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8111280>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef6c0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:31:25.000000', 'message', 'group', '1444596404', '[{"type": "text", "data": {"text": "她直接开大了"}}]', '她直接开大了', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88e89c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d879ef60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468840>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8978490>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8978490>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-5, stopped daemon 140568759883520)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b030>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0f53340>, <coroutine object _run_coro_with_catch at 0x7fd8d8aaf640>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0f53ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647044038, self_id=507346814, post_type='message', sub_type='normal', user_id=594352301, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d835c7c0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d898b520>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d835c7c0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d879ef60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d898b520>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d898b520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d898b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d898b6d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d898b520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8312b50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8312730>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8312730>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '594352301', 'time': datetime.datetime(2022, 3, 12, 0, 13, 58, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8312520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d82bc4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d88e89c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d879ef60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468840>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8978490>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8978490>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-5, stopped daemon 140568759883520)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83e21f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b5b030>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 00:13:58.000000', 'message', 'group', '1640495709', '[{"type": "text", "data": {"text": "这怎么回事呀"}}, {"type": "face", "data": {"id": "32"}}]', '这怎么回事呀', '594352301', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdaac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdaac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdaac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8648640>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f0abf0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d164a740>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594340>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594340>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-50, stopped daemon 140568097056512)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80efc60>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8b560c0>, <coroutine object _run_coro_with_catch at 0x7fd8d8b56340>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8b56240>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048176, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8b3dd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8b3d790>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8b3dd00>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f0abf0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8b3d790>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8b3d790>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d961d640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d961d640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8b3d790>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d961d580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d961d760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d961d760>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 1, 22, 56, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d961d130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdaac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdaac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8bdaac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8648640>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f0abf0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d164a740>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d8594340>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d8594340>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-50, stopped daemon 140568097056512)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d837fca0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80efc60>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:22:56.000000', 'message', 'group', '-249746596', '[{"type": "text", "data": {"text": "你就乱想"}}]', '你就乱想', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d85a8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d85a8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d85a8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80b7340>
           └ <_AsyncIoGreenlet object at 0x7fd8d16479e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d80d1a40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d85946c0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d85946c0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-39, stopped daemon 140568189376256)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef210>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8872ec0>, <coroutine object _run_coro_with_catch at 0x7fd8d8872ac0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d878fc40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048587, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d15764f0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d15760d0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d15764f0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d16479e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d15760d0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d15760d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83a1160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83a1160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d15760d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83a10a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d83a1df0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d83a1df0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 29, 47, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83a1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d85a8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d85a8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d85a8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80b7340>
           └ <_AsyncIoGreenlet object at 0x7fd8d16479e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d80d1a40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d85946c0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d85946c0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-39, stopped daemon 140568189376256)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15e00d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef210>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:29:47.000000', 'message', 'group', '1724904148', '[{"type": "text", "data": {"text": "不然真成了"}}]', '不然真成了', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1029dc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f7f880 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468f40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89780a0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89780a0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-22, stopped daemon 140568332052224)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d6120>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d83a7740>, <coroutine object _run_coro_with_catch at 0x7fd8d8cf2140>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8cf25c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048098, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8372640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8372400>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8372640>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f7f880 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8372400>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8372400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8372dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8372dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8372400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8843a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8843190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8843190>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 21, 38, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8843940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8b81dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1029dc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f7f880 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8468f40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89780a0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89780a0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-22, stopped daemon 140568332052224)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d17d6120>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:21:38.000000', 'message', 'group', '-278143484', '[{"type": "text", "data": {"text": "完蛋了"}}]', '完蛋了', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d83434c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d83434c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d83434c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d87dabc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8124eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d888ab40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf490>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf490>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-93, started daemon 140567736170240)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85ab7b0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8038540>, <coroutine object _run_coro_with_catch at 0x7fd8d80383c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d85d6540>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052316, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8812dc0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8812520>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8812dc0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8124eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8812520>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8812520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8812fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8812fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8812520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8812d60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88123a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88123a0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 31, 56, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8812970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d83434c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d83434c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d83434c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d87dabc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8124eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d888ab40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf490>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf490>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-93, started daemon 140567736170240)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c13460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85ab7b0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:31:56.000000', 'message', 'group', '1996687660', '[{"type": "text", "data": {"text": "中考去了？"}}]', '中考去了？', '2560359315', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d877ba40>
           └ <_AsyncIoGreenlet object at 0x7fd8d86f1670 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a9440>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bfd50>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bfd50>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-71, started daemon 140567920809728)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1210>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d88081c0>, <coroutine object _run_coro_with_catch at 0x7fd8d17a43c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d859dec0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052367, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d874ba60>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6100>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d874ba60>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d86f1670 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6100>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d86e6dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d86e6dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d86e68b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d86e6310>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d86e6310>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 32, 47, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86e6c40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d877ba40>
           └ <_AsyncIoGreenlet object at 0x7fd8d86f1670 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a9440>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bfd50>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bfd50>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-71, started daemon 140567920809728)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8bf19d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1210>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:32:47.000000', 'message', 'group', '1325530101', '[{"type": "text", "data": {"text": "起这么晚"}}]', '起这么晚', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10410c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d87faf60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a98c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d2b90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d2b90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-84, stopped daemon 140567811704576)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1e40>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fd8640>, <coroutine object _run_coro_with_catch at 0x7fd8d0fd8940>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0fd83c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052445, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d1733be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d1733c70>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d1733be0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d87faf60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d1733c70>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d1733c70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d1733ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d1733ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d1733c70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d81c5ca0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1733100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1733100>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1617678696', 'time': datetime.datetime(2022, 3, 12, 2, 34, 5, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81c56d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10410c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d87faf60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a98c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d2b90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d2b90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-84, stopped daemon 140567811704576)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d10a7310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1e40>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:34:05.000000', 'message', 'group', '1680648246', '[{"type": "text", "data": {"text": "？私聊会被检测的吗"}}]', '？私聊会被检测的吗', '1617678696', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0fdf740>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f9bb40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d85f0cc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf570>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf570>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-97, stopped daemon 140567702599424)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85abb70>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d87fc3c0>, <coroutine object _run_coro_with_catch at 0x7fd8d87fc840>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d85c05c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052361, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8460790>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d84606a0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8460790>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f9bb40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d84606a0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d84606a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8460610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8460610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d84606a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d899c100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8460700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8460700>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 32, 41, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d899c820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0fdf740>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f9bb40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d85f0cc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf570>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf570>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-97, stopped daemon 140567702599424)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8499ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85abb70>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '-1592812839', '[{"type": "text", "data": {"text": "现在她的号挂在服务器上"}}]', '现在她的号挂在服务器上', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1743140>
           └ <_AsyncIoGreenlet object at 0x7fd8d8351460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a91c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf180>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf180>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-57, stopped daemon 140568038307584)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d860a4e0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d82e2cc0>, <coroutine object _run_coro_with_catch at 0x7fd8d179aec0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d82e2640>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647050917, self_id=507346814, post_type='message', sub_type='normal', user_id=1337831451, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8085550>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8085e50>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8085550>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8351460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8085e50>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8085e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8085520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8085520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8085e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8a07550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8a07a60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8a07a60>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1337831451', 'time': datetime.datetime(2022, 3, 12, 2, 8, 37, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a07070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1743140>
           └ <_AsyncIoGreenlet object at 0x7fd8d8351460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a91c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf180>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf180>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-57, stopped daemon 140568038307584)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8384310>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d860a4e0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:08:37.000000', 'message', 'group', '139560894', '[{"type": "text", "data": {"text": "都只调试过几次"}}]', '都只调试过几次', '1337831451', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:12 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d89deee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d89deee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d89deee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8ae9040>
           └ <_AsyncIoGreenlet object at 0x7fd8d89b2460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d889e840>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d0340>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d0340>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-128, stopped daemon 140567442425600)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8be1a80>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d80c5440>, <coroutine object _run_coro_with_catch at 0x7fd8d80c55c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d80c5340>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052577, self_id=507346814, post_type='message', sub_type='normal', user_id=3531890582, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d84d9a60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d84d9310>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d84d9a60>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d89b2460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d84d9310>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d84d9310>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84d9a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84d9a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d84d9310>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d16c0130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d16c01f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d16c01f0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3531890582', 'time': datetime.datetime(2022, 3, 12, 2, 36, 17, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d16c09a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d89deee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d89deee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d89deee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8ae9040>
           └ <_AsyncIoGreenlet object at 0x7fd8d89b2460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d889e840>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d0340>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d0340>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-128, stopped daemon 140567442425600)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8c8f910>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8be1a80>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:36:17.000000', 'message', 'group', '124386723', '[{"type": "at", "data": {"qq": "3479060093"}}]', '', '3531890582', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d888a9c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d16ef3b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d888a2c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf260>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf260>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-86, stopped daemon 140567794919168)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85ab120>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d85bc140>, <coroutine object _run_coro_with_catch at 0x7fd8d0f06dc0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d85bcd40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052141, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8d137f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8d13b20>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8d137f0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d16ef3b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8d13b20>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8d13b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8d13760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8d13760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8d13b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8d13970>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8d13e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8d13e50>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 29, 1, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d177ca30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836cf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d888a9c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d16ef3b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d888a2c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bf260>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bf260>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-86, stopped daemon 140567794919168)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d88a64f0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85ab120>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:29:01.000000', 'message', 'group', '16999383', '[{"type": "text", "data": {"text": "她在休养生息"}}]', '她在休养生息', '2560359315', '277620613')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8625640>
           └ <_AsyncIoGreenlet object at 0x7fd8d171b7d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d82f93c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89e7650>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89e7650>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-99, stopped daemon 140567685814016)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85abd50>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d87fca40>, <coroutine object _run_coro_with_catch at 0x7fd8d87fce40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d95e09c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052361, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d87ef640>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d87fdf70>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d87ef640>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d171b7d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d87fdf70>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d87fdf70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87fdb80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87fdb80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d87fdf70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87fd880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d87fdfd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d87fdfd0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 32, 41, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87fd6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8625640>
           └ <_AsyncIoGreenlet object at 0x7fd8d171b7d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d82f93c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89e7650>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89e7650>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-99, stopped daemon 140567685814016)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84416d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d85abd50>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:32:41.000000', 'message', 'group', '939969379', '[{"type": "text", "data": {"text": "但事件处理没开"}}]', '但事件处理没开', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d889ec40>
           └ <_AsyncIoGreenlet object at 0x7fd8d882d9e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d104d340>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4030>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4030>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-136, stopped daemon 140567375283968)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8381300>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d80de540>, <coroutine object _run_coro_with_catch at 0x7fd8d80de240>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d80def40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052605, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d82a4a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d82a4040>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d82a4a90>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d882d9e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d82a4040>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d82a4040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d82a4bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d82a4bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d82a4040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8743070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8743e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8743e50>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 36, 45, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87431c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d889ec40>
           └ <_AsyncIoGreenlet object at 0x7fd8d882d9e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d104d340>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4030>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4030>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-136, stopped daemon 140567375283968)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8337b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8381300>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:36:45.000000', 'message', 'group', '-1302040757', '[{"type": "text", "data": {"text": "真就"}}]', '真就', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8a78440>
           └ <_AsyncIoGreenlet object at 0x7fd8d8115720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d889ecc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d0f80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d0f80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-143, stopped daemon 140567316535040)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8381990>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fec240>, <coroutine object _run_coro_with_catch at 0x7fd8d0fec5c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0fec840>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052582, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0f08be0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d0f08a90>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0f08be0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8115720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d0f08a90>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0f08a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0f08ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0f08ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0f08a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8865700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8865640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8865640>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 36, 22, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8865be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8a78440>
           └ <_AsyncIoGreenlet object at 0x7fd8d8115720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d889ecc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d0f80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d0f80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-143, stopped daemon 140567316535040)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fb20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8381990>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:36:22.000000', 'message', 'group', '-1408067053', '[{"type": "text", "data": {"text": "如果你有想法，我不知道；如果你没有想法，正常聊"}}]', '如果你有想法，我不知道；如果你没有想法，正常聊', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d15b9ec0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8d9bf60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a9e40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d2c70>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d2c70>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-81, stopped daemon 140567836882688)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1b70>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fd8c40>, <coroutine object _run_coro_with_catch at 0x7fd8d0fd8840>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d16fa240>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052426, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83e2940>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d84c9730>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83e2940>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8d9bf60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d84c9730>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d84c9730>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84c9a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84c9a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d84c9730>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84c9f70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84c9100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84c9100>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1617678696', 'time': datetime.datetime(2022, 3, 12, 2, 33, 46, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84c9130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d15b9ec0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8d9bf60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16a9e40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d2c70>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d2c70>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-81, stopped daemon 140567836882688)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d16e7220>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1b70>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:33:46.000000', 'message', 'group', '321624224', '[{"type": "text", "data": {"text": "收购腾讯（钩"}}]', '收购腾讯（钩', '1617678696', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8aafdc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d868feb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8afd3c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bfb90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bfb90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-68, stopped daemon 140567945987840)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d860ae40>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d17a4dc0>, <coroutine object _run_coro_with_catch at 0x7fd8d17a4d40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d17a4540>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052350, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d81ccdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d81cc4f0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d81ccdc0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d868feb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d81cc4f0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d81cc4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d81ccf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d81ccf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d81cc4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8404e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8404370>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8404370>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1617678696', 'time': datetime.datetime(2022, 3, 12, 2, 32, 30, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8404af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d836c040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8aafdc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d868feb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8afd3c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89bfb90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89bfb90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-68, stopped daemon 140567945987840)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355b80>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d860ae40>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:32:30.000000', 'message', 'group', '-1043852484', '[{"type": "text", "data": {"text": "坏掉了"}}]', '坏掉了', '1617678696', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343d00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343d00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343d00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80698c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d1755b40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87826c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89e7030>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89e7030>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-103, stopped daemon 140567652243200)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d89f5210>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d87fc640>, <coroutine object _run_coro_with_catch at 0x7fd8d87fc2c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d854a940>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052400, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0ea8f70>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d0ea8100>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0ea8f70>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d1755b40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d0ea8100>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0ea8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0ea8f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0ea8f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0ea8100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0ea8a60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0ea8f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0ea8f40>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 33, 20, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0ea84c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343d00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343d00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8343d00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80698c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d1755b40 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87826c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89e7030>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89e7030>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-103, stopped daemon 140567652243200)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8d61400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d89f5210>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:33:20.000000', 'message', 'group', '-657251715', '[{"type": "text", "data": {"text": "看来得把私聊的权限限制一下"}}]', '看来得把私聊的权限限制一下', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d83079c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d868c930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87da2c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101ab90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101ab90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-191, stopped daemon 140566913685248)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b11b70>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d1017ec0>, <coroutine object _run_coro_with_catch at 0x7fd8d10170c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d10174c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052690, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83233a0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8323ac0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83233a0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d868c930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8323ac0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8323ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8323460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8323460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8323ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8323d60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8323dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8323dc0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 38, 10, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8323e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d83079c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d868c930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87da2c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101ab90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101ab90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-191, stopped daemon 140566913685248)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d178ee20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b11b70>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:38:10.000000', 'message', 'group', '-264701626', '[{"type": "text", "data": {"text": "那就是吧"}}]', '那就是吧', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0ec96c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d854bd50 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d83071c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101aa40>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101aa40>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-161, stopped daemon 140567165466368)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916b70>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d1693e40>, <coroutine object _run_coro_with_catch at 0x7fd8d8ae9240>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d17ecb40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052655, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d89094c0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8909880>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d89094c0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d854bd50 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8909880>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8909880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8909f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8909f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8909880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d86dfd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d86dfa00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d86dfa00>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 37, 35, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d15761f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bd00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0ec96c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d854bd50 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d83071c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101aa40>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101aa40>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-161, stopped daemon 140567165466368)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916b70>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:35.000000', 'message', 'group', '1881840061', '[{"type": "text", "data": {"text": "啧"}}]', '啧', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1578540>
           └ <_AsyncIoGreenlet object at 0x7fd8d87553b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d830ba40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101a180>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101a180>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-156, stopped daemon 140567207429888)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d89166c0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8307f40>, <coroutine object _run_coro_with_catch at 0x7fd8d8307c40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8307b40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052638, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d847d940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d9613700>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d847d940>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d87553b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d9613700>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d9613700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d96135e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d96135e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d9613700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d81e6e20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d81e63d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d81e63d0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1617678696', 'time': datetime.datetime(2022, 3, 12, 2, 37, 18, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d81e6640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1578540>
           └ <_AsyncIoGreenlet object at 0x7fd8d87553b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d830ba40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101a180>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101a180>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-156, stopped daemon 140567207429888)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d89166c0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:18.000000', 'message', 'group', '-1723253624', '[{"type": "text", "data": {"text": "不是"}}]', '不是', '1617678696', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '161...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '161...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0ec93c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d82b0eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d83075c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '161...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101a960>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101a960>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-160, stopped daemon 140567173859072)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916a80>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8a64640>, <coroutine object _run_coro_with_catch at 0x7fd8d1693ec0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8a642c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052649, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8ce2250>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d833c4c0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8ce2250>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d82b0eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d833c4c0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d833c4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87a7820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87a7820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d833c4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83c87f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d83c8550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d83c8550>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1617678696', 'time': datetime.datetime(2022, 3, 12, 2, 37, 29, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d9617670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '161...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '161...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bc40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0ec93c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d82b0eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d83075c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '161...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101a960>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101a960>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-160, stopped daemon 140567173859072)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83378b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916a80>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:29.000000', 'message', 'group', '-383531001', '[{"type": "text", "data": {"text": "？"}}]', '？', '1617678696', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:13 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '256...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe4340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe4340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '256...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe4340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8877740>
           └ <_AsyncIoGreenlet object at 0x7fd8d102e9e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d10418c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '256...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101ad50>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101ad50>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-186, stopped daemon 140566955648768)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b116c0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d10171c0>, <coroutine object _run_coro_with_catch at 0x7fd8d1017040>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d1017440>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052668, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8771a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8771130>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8771a90>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d102e9e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8771130>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8771130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87711f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87711f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8771130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8771310>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8771f70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8771f70>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 37, 48, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87713a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '256...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe4340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe4340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '256...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0fe4340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8877740>
           └ <_AsyncIoGreenlet object at 0x7fd8d102e9e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d10418c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '256...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101ad50>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101ad50>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-186, stopped daemon 140566955648768)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8843070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b116c0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:48.000000', 'message', 'group', '-527072212', '[{"type": "text", "data": {"text": "？"}}]', '？', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e9c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e9c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e9c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8a196c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d80ea300 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87aa740>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e9e650>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e9e650>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-255, stopped daemon 140566384944896)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff58a0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d88d4640>, <coroutine object _run_coro_with_catch at 0x7fd8d88d42c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8d6f6c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647055094, self_id=507346814, post_type='message', sub_type='normal', user_id=3531890582, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d1500a90>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d1500be0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d1500a90>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d80ea300 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d1500be0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d1500be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d1500ca0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d1500ca0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d1500be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d15003a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1500220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1500220>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3531890582', 'time': datetime.datetime(2022, 3, 12, 3, 18, 14, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d1500070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？'...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e9c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e9c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？'...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e9c1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8a196c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d80ea300 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87aa740>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？'...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e9e650>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e9e650>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-255, stopped daemon 140566384944896)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84ec400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff58a0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 03:18:14.000000', 'message', 'group', '1757333431', '[{"type": "text", "data": {"text": "...？"}}]', '...？', '3531890582', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0ec9340>
           └ <_AsyncIoGreenlet object at 0x7fd8d10099e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16f57c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101ace0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101ace0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-164, stopped daemon 140567140288256)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916e40>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d17ece40>, <coroutine object _run_coro_with_catch at 0x7fd8d8ae9a40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8ae9340>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052658, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8210a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8210400>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8210a30>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d10099e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8210400>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8210400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8210c10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8210c10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8210400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8ca9100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8ca93a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8ca93a0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 37, 38, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8a34f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104bf40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0ec9340>
           └ <_AsyncIoGreenlet object at 0x7fd8d10099e0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16f57c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101ace0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101ace0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-164, stopped daemon 140567140288256)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d162b3d0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916e40>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:38.000000', 'message', 'group', '120432939', '[{"type": "text", "data": {"text": "没想到啊"}}]', '没想到啊', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e6e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e6e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e6e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80741c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d83e1250 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8d6fac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e69110>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e69110>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-233, stopped daemon 140566569584384)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0f14300>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d17498c0>, <coroutine object _run_coro_with_catch at 0x7fd8d1749bc0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d1749cc0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053424, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d89e8880>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d89e8b80>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d89e8880>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d83e1250 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d89e8b80>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d89e8b80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d89e8af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d89e8af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d89e8b80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d89e8130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d89e8f70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d89e8f70>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 50, 24, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d89e8190>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e6e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e6e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e6e1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d80741c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d83e1250 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8d6fac0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e69110>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e69110>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-233, stopped daemon 140566569584384)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d896fa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0f14300>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:50:24.000000', 'message', 'group', '1518904629', '[{"type": "text", "data": {"text": "就是直接放弃的"}}]', '就是直接放弃的', '2560359315', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazh...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazh...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0f3ee40>
           └ <_AsyncIoGreenlet object at 0x7fd8d8774720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d882b140>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazh...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101a260>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101a260>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-174, stopped daemon 140567056361216)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d82928a0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d82a30c0>, <coroutine object _run_coro_with_catch at 0x7fd8d82a37c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d82a39c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052784, self_id=507346814, post_type='message', sub_type='normal', user_id=1183338091, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d84c9eb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d83e27c0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d84c9eb0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8774720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d83e27c0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d83e27c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83e2640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83e2640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d83e27c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84168e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84163a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84163a0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1183338091', 'time': datetime.datetime(2022, 3, 12, 2, 39, 44, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8416160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazh...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazh...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0f3ee40>
           └ <_AsyncIoGreenlet object at 0x7fd8d8774720 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d882b140>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazh...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101a260>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101a260>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-174, stopped daemon 140567056361216)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d86862b0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d82928a0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:39:44.000000', 'message', 'group', '-1774906851', '[{"type": "text", "data": {"text": "https://www.dazhuanlan.com/cquake/topics/1372771"}}]', 'https://www.dazhuanlan.com/cquake/topics/1372771', '1183338091', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10084c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10084c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10084c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0f2cf40>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f875c0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8625740>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101af10>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101af10>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-168, stopped daemon 140567106717440)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8292300>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d164eb40>, <coroutine object _run_coro_with_catch at 0x7fd8d164e8c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d164e3c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052676, self_id=507346814, post_type='message', sub_type='normal', user_id=1617678696, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8279790>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d82796a0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8279790>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f875c0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d82796a0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d82796a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d82796d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d82796d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d82796a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d16051f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1605f70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d1605f70>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1617678696', 'time': datetime.datetime(2022, 3, 12, 2, 37, 56, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d80f1280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10084c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10084c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10084c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0f2cf40>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f875c0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8625740>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101af10>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101af10>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-168, stopped daemon 140567106717440)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83cd430>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8292300>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:56.000000', 'message', 'group', '-2142106167', '[{"type": "text", "data": {"text": "你说是"}}]', '你说是', '1617678696', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d16936c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f79460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16933c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101adc0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101adc0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-147, stopped daemon 140567282964224)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8381d50>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8d7c6c0>, <coroutine object _run_coro_with_catch at 0x7fd8d8d7c5c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d104d040>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052622, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8337100>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d83370a0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8337100>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f79460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d83370a0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d83370a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8337e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8337e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d83370a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83d9e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84046a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84046a0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 37, 2, tzinfo=datetime.timezone.utc), 'platform': 'qq', '...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83d98e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1008280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d16936c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f79460 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16933c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d101adc0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d101adc0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-147, stopped daemon 140567282964224)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d1540d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8381d50>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:02.000000', 'message', 'group', '728579825', '[{"type": "text", "data": {"text": "。。。"}}]', '。。。', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f7d8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f7d8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f7d8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10233c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d88aceb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d95e0bc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e69650>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e69650>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-193, stopped daemon 140566896899840)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d842a6c0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d17f9340>, <coroutine object _run_coro_with_catch at 0x7fd8d17f9d40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d17f99c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052812, self_id=507346814, post_type='message', sub_type='normal', user_id=1183338091, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0fc93a0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc9700>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0fc93a0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d88aceb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc9700>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc9700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d80a5310>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d80a5310>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc9700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d177cbb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d177c7c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d177c7c0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1183338091', 'time': datetime.datetime(2022, 3, 12, 2, 40, 12, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d893f3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f7d8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f7d8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f7d8e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10233c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d88aceb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d95e0bc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e69650>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e69650>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-193, stopped daemon 140566896899840)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8686b20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d842a6c0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:40:12.000000', 'message', 'group', '1905082138', '[{"type": "text", "data": {"text": "装OpenCV教程啊"}}]', '装OpenCV教程啊', '1183338091', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10105c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d880a510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8040bc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d0960>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d0960>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-142, stopped daemon 140567324927744)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d83818a0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fecc40>, <coroutine object _run_coro_with_catch at 0x7fd8d0fec6c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0fec040>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052558, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8a120a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8a12280>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8a120a0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d880a510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8a12280>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8a12280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8a12b50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8a12b50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8a12280>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8552f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d85520a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d85520a0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 35, 58, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d85524f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d87cf820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d10105c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d880a510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8040bc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89d0960>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89d0960>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-142, stopped daemon 140567324927744)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8355a90>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d83818a0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:35:58.000000', 'message', 'group', '1165049638', '[{"type": "text", "data": {"text": "正常聊"}}]', '正常聊', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8b1eb40>
           └ <_AsyncIoGreenlet object at 0x7fd8d86453b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8b1ecc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0fe1f10>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0fe1f10>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-183, stopped daemon 140566980826880)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b113f0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d1017a40>, <coroutine object _run_coro_with_catch at 0x7fd8d1017840>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d1749a40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052643, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d803b4c0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8812700>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d803b4c0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d86453b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8812700>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8812700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8812e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8812e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8812700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d159af40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d159a130>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d159a130>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 37, 23, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d159aaf0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8b1eb40>
           └ <_AsyncIoGreenlet object at 0x7fd8d86453b0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8b1ecc0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0fe1f10>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0fe1f10>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-183, stopped daemon 140566980826880)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fdf0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8b113f0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:23.000000', 'message', 'group', '2001165732', '[{"type": "text", "data": {"text": "男人嘛"}}]', '男人嘛', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8b1ea40>
           └ <_AsyncIoGreenlet object at 0x7fd8d86cfa90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8b1ef40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0fe1f80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0fe1f80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-152, stopped daemon 140567241000704)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916300>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d82f9040>, <coroutine object _run_coro_with_catch at 0x7fd8d8b1e540>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d82f9ac0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052632, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d15fa430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d15fa940>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d15fa430>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d86cfa90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d15fa940>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d15fa940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d15faa00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d15faa00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d15fa940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d80a7490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d80a7ee0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d80a7ee0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 37, 12, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8b7ee50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事',...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事',...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d104b760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8b1ea40>
           └ <_AsyncIoGreenlet object at 0x7fd8d86cfa90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8b1ef40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事',...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0fe1f80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0fe1f80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-152, stopped daemon 140567241000704)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d893fcd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8916300>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:12.000000', 'message', 'group', '-1128274055', '[{"type": "text", "data": {"text": "有故事"}}]', '有故事', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfd...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfd...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8a19840>
           └ <_AsyncIoGreenlet object at 0x7fd8d8582040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d84529c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfd...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e25810>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e25810>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-272, stopped daemon 140568231339776)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0eb08a0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d17f9440>, <coroutine object _run_coro_with_catch at 0x7fd8d830b4c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d830bdc0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048655, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d86a9460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d86a9520>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d86a9460>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8582040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d86a9520>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d86a9520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87bf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87bf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d86a9520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d87bffa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d87bff40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d87bff40>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 1, 30, 55, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d87bf700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfd...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfd...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8a19840>
           └ <_AsyncIoGreenlet object at 0x7fd8d8582040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d84529c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfd...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e25810>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e25810>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-272, stopped daemon 140568231339776)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d899fa00>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0eb08a0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:30:55.000000', 'message', 'group', '-1206604904', '[{"type": "image", "data": {"file": "27e4ac7b4638bfdb53a0f198b84351be.image", "url": "https://gchat.qpic.cn/gchatpic_new/2560359315/937760225-2796056680-27E4AC7B4638BFDB53A0F198B84351BE/0?term=3", "subType": "1"}}]', '', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8040e40>
           └ <_AsyncIoGreenlet object at 0x7fd8d0e2a930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8afdec0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e34f80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e34f80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-283, stopped daemon 140566158341888)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e273f0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8831440>, <coroutine object _run_coro_with_catch at 0x7fd8d8831ac0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d17c02c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647044065, self_id=507346814, post_type='message', sub_type='normal', user_id=594352301, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0fc9d00>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc92e0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0fc9d00>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0e2a930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc92e0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc92e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d10b1040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d10b1040>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0fc92e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8cb18b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8cb1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8cb1fa0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '594352301', 'time': datetime.datetime(2022, 3, 12, 0, 14, 25, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cb1880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8040e40>
           └ <_AsyncIoGreenlet object at 0x7fd8d0e2a930 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8afdec0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e34f80>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e34f80>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-283, stopped daemon 140566158341888)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15ba3a0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e273f0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 00:14:25.000000', 'message', 'group', '296554194', '[{"type": "image", "data": {"file": "5ef49d8b0147fc213092b84f174ad98a.image", "url": "https://gchat.qpic.cn/gchatpic_new/594352301/204222191-2927092429-5EF49D8B0147FC213092B84F174AD98A/0?term=3", "subType": "0"}}]', '', '594352301', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f753a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f753a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f753a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d17df740>
           └ <_AsyncIoGreenlet object at 0x7fd8d10737d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d179a6c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e69b20>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e69b20>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-208, stopped daemon 140566771009280)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d10a8990>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d83073c0>, <coroutine object _run_coro_with_catch at 0x7fd8d842c040>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d842c3c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053052, self_id=507346814, post_type='message', sub_type='normal', user_id=3479060093, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88cd0a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d88cd520>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88cd0a0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d10737d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d88cd520>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88cd520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88cdeb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88cdeb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88cd520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0fb4f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0fb41c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0fb41c0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3479060093', 'time': datetime.datetime(2022, 3, 12, 2, 44, 12, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8d13bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', ...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f753a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f753a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', ...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f753a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d17df740>
           └ <_AsyncIoGreenlet object at 0x7fd8d10737d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d179a6c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', ...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e69b20>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e69b20>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-208, stopped daemon 140566771009280)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d81c5fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d10a8990>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:44:12.000000', 'message', 'group', '1133745268', '[{"type": "text", "data": {"text": "不🔒了"}}]', '不🔒了', '3479060093', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:14 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c2e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c2e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c2e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d961bd40>
           └ <_AsyncIoGreenlet object at 0x7fd8d85825c0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8452040>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e25880>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e25880>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-273, stopped daemon 140566242268928)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0eb0990>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d15d35c0>, <coroutine object _run_coro_with_catch at 0x7fd8d15d3b40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8b62cc0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647048053, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8b17460>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8b17f10>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8b17460>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d85825c0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8b17f10>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8b17f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8b17670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8b17670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8b17f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d82e1d30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d82e1eb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d82e1eb0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 1, 20, 53, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d82e1490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c2e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c2e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e2c2e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d961bd40>
           └ <_AsyncIoGreenlet object at 0x7fd8d85825c0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8452040>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e25880>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e25880>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-273, stopped daemon 140566242268928)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d899f460>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0eb0990>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 01:20:53.000000', 'message', 'group', '1986170814', '[{"type": "image", "data": {"file": "0379636bddb00222a599adaf2a4d74e3.image", "url": "https://gchat.qpic.cn/gchatpic_new/963046537/937760225-2377617958-0379636BDDB00222A599ADAF2A4D74E3/0?term=3", "subType": "1"}}]', '', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eaf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eaf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eaf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1743540>
           └ <_AsyncIoGreenlet object at 0x7fd8d86ac040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d80de1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0ed5c00>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0ed5c00>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-259, stopped daemon 140566351374080)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff5e40>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8b8aac0>, <coroutine object _run_coro_with_catch at 0x7fd8d8b8a1c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8b8a5c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052629, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0ea83d0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8411b80>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0ea83d0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d86ac040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8411b80>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8411b80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84ec1f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84ec1f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8411b80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d84ec640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84ecd60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d84ecd60>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 37, 9, tzinfo=datetime.timezone.utc), 'platform': 'qq', '...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ec070>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eaf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eaf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eaf1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d1743540>
           └ <_AsyncIoGreenlet object at 0x7fd8d86ac040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d80de1c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0ed5c00>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0ed5c00>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-259, stopped daemon 140566351374080)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8201e20>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff5e40>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:37:09.000000', 'message', 'group', '1527237246', '[{"type": "at", "data": {"qq": "1617678696"}}, {"type": "text", "data": {"text": " 有故事"}}]', ' 有故事', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8069ac0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8125a90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d80694c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e912d0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e912d0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-242, stopped daemon 140566494050048)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0f14b70>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d80cb740>, <coroutine object _run_coro_with_catch at 0x7fd8d16c1e40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d8b41c40>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053856, self_id=507346814, post_type='message', sub_type='normal', user_id=3479060093, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8686f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8686760>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8686f10>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8125a90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8686760>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8686760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8686fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8686fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8686760>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d10a7100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d86865b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d86865b0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3479060093', 'time': datetime.datetime(2022, 3, 12, 2, 57, 36, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8474430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8069ac0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8125a90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d80694c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e912d0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e912d0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-242, stopped daemon 140566494050048)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15d5370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0f14b70>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:57:36.000000', 'message', 'group', '-272538795', '[{"type": "text", "data": {"text": "在河南考上一本的分再多十来分 在陕西就可以上211了"}}]', '在河南考上一本的分再多十来分 在陕西就可以上211了', '3479060093', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running CalledAPI hook. Running cancelled!
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eb83a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eb83a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eb83a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8aca940>
           └ <_AsyncIoGreenlet object at 0x7fd8d8091510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d0f31140>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0eddea0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0eddea0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-257, stopped daemon 140566368159488)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff5a80>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 104, in call_api
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object record_send_msg at 0x7fd8d16f54c0>, <coroutine object record_send_msg at 0x7fd8d16f5a40>, <coroutine objec...
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 75, in record_send_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d95f02b0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d841e640>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d95f02b0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8091510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d841e640>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d841e640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d10b1d60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d10b1d60>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d841e640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d10b1fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d10b1be0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d10b1be0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '507346814', 'time': datetime.datetime(2022, 3, 12, 3, 21, 7, 332766), 'platform': 'qq', 'group_id': '', 'alt_me...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d10b1e80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eb83a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eb83a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0eb83a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8aca940>
           └ <_AsyncIoGreenlet object at 0x7fd8d8091510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d0f31140>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0eddea0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0eddea0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-257, stopped daemon 140566368159488)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8050370>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff5a80>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 03:21:07.332766', 'message', 'private', '-1885185892', '[{"type": "text", "data": {"text": "呜——出错了...追踪: q59azBQ3"}}]', '呜——出错了...追踪: q59azBQ3', '507346814', '')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d83a79c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d80d37d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87aa440>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e9e2d0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e9e2d0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-252, stopped daemon 140566410123008)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff55d0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8d6f4c0>, <coroutine object _run_coro_with_catch at 0x7fd8d807b640>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d807b7c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647054775, self_id=507346814, post_type='message', sub_type='normal', user_id=3479060093, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88611f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d88610d0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88611f0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d80d37d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d88610d0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88610d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8861af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8861af0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88610d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8861550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8861a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8861a90>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3479060093', 'time': datetime.datetime(2022, 3, 12, 3, 12, 55, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8861e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e92f40>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d83a79c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d80d37d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d87aa440>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e9e2d0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e9e2d0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-252, stopped daemon 140566410123008)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8be8fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0ff55d0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 03:12:55.000000', 'message', 'group', '-2035243365', '[{"type": "text", "data": {"text": "给你讲个笑话"}}]', '给你讲个笑话', '3479060093', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909c...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909c...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8840540>
           └ <_AsyncIoGreenlet object at 0x7fd8d0e38250 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d0fbec40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909c...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e42180>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e42180>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-285, stopped daemon 140566141556480)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e275d0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fbe8c0>, <coroutine object _run_coro_with_catch at 0x7fd8d0fbe9c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0fbe840>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647044049, self_id=507346814, post_type='message', sub_type='normal', user_id=594352301, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d15ba7c0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d15ba790>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d15ba7c0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0e38250 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d15ba790>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d15ba790>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d176e8b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d176e8b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d15ba790>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d176e340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d176e790>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d176e790>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '594352301', 'time': datetime.datetime(2022, 3, 12, 0, 14, 9, tzinfo=datetime.timezone.utc), 'platform': 'qq', '...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d176ea90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909c...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909c...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0e3c340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8840540>
           └ <_AsyncIoGreenlet object at 0x7fd8d0e38250 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d0fbec40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909c...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e42180>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e42180>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-285, stopped daemon 140566141556480)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d17292e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e275d0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 00:14:09.000000', 'message', 'group', '-2002493592', '[{"type": "image", "data": {"file": "5fc16bf8fc0909caa7fe305e1d98d046.image", "url": "https://gchat.qpic.cn/gchatpic_new/594352301/204222191-2168538649-5FC16BF8FC0909CAA7FE305E1D98D046/0?term=3", "subType": "0"}}]', '', '594352301', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634eb...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10638e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10638e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634eb...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10638e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0f2c9c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8297f60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d1017940>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634eb...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d16e06c0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d16e06c0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-296, started daemon 140567123502848)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8be1210>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d174f640>, <coroutine object _run_coro_with_catch at 0x7fd8d174f440>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d174f6c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052529, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d899f9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8088490>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d899f9a0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8297f60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8088490>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8088490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d80885e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d80885e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8088490>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0f44160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0f44580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0f44580>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 35, 29, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d824cd30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634eb...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10638e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10638e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634eb...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10638e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d0f2c9c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8297f60 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d1017940>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634eb...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d16e06c0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d16e06c0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-296, started daemon 140567123502848)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83c3100>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8be1210>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:35:29.000000', 'message', 'group', '-1646104471', '[{"type": "image", "data": {"file": "4e994f1332634ebdd46b4a939fd704e3.image", "url": "https://gchat.qpic.cn/gchatpic_new/963046537/937760225-2190839201-4E994F1332634EBDD46B4A939FD704E3/0?term=3", "subType": "1"}}]', '', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d85507c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f88510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8550f40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d1538500>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d1538500>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-292, started daemon 140567576708864)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8292030>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d17f3d40>, <coroutine object _run_coro_with_catch at 0x7fd8d17f3c40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d17f3dc0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052505, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83ee430>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d83ee160>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d83ee430>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d0f88510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d83ee160>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d83ee160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83ee220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83ee220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d83ee160>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83ee4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d83eeb80>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d83eeb80>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 35, 5, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d83ee5e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063460>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d85507c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d0f88510 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8550f40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d1538500>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d1538500>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-292, started daemon 140567576708864)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d1684070>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8292030>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:35:05.000000', 'message', 'group', '224226808', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f0bb083f0d751db4.image", "url": "https://gchat.qpic.cn/gchatpic_new/2560359315/937760225-2804430082-8595F73F4B4DB8B7F0BB083F0D751DB4/0?term=3", "subType": "1"}}]', '', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10630a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10630a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10630a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d842c640>
           └ <_AsyncIoGreenlet object at 0x7fd8d8a15e00 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8c914c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e89960>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e89960>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-300, stopped daemon 140566107985664)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e27990>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d82e2540>, <coroutine object _run_coro_with_catch at 0x7fd8d82e29c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d82e26c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052585, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8834bb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8834fd0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8834bb0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8a15e00 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8834fd0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8834fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8a18820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8a18820>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8834fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8a18b50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8a18700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8a18700>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 36, 25, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8289640>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10630a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10630a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d10630a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d842c640>
           └ <_AsyncIoGreenlet object at 0x7fd8d8a15e00 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8c914c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e89960>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e89960>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-300, stopped daemon 140566107985664)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d841e550>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e27990>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:36:25.000000', 'message', 'group', '-619337083', '[{"type": "image", "data": {"file": "2a91182255ae9e4e98878a87840f86a6.image", "url": "https://gchat.qpic.cn/gchatpic_new/2560359315/937760225-3191104855-2A91182255AE9E4E98878A87840F86A6/0?term=3", "subType": "1"}}]', '', '2560359315', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f50700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f50700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f50700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d889e3c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d80b8eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16851c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4c00>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4c00>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-319, stopped daemon 140566838150912)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d89f5d50>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d8040b40>, <coroutine object _run_coro_with_catch at 0x7fd8d16cd7c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d859dbc0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052985, self_id=507346814, post_type='message', sub_type='normal', user_id=3479060093, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d874b730>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8474f10>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d874b730>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d80b8eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8474f10>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8474f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8904a00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8904a00>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8474f10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8201940>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88fdbe0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88fdbe0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3479060093', 'time': datetime.datetime(2022, 3, 12, 2, 43, 5, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d84ce550>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f50700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f50700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d0f50700>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d889e3c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d80b8eb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16851c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4c00>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4c00>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-319, stopped daemon 140566838150912)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d95e0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d89f5d50>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:43:05.000000', 'message', 'group', '249541000', '[{"type": "image", "data": {"file": "62c3aa99f9ee6b80b8499ce25fd3fa34.image", "url": "https://gchat.qpic.cn/gchatpic_new/3479060093/962699166-3071721245-62C3AA99F9EE6B80B8499CE25FD3FA34/0?term=3", "subType": "1"}}]', '', '3479060093', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8b8aa40>
           └ <_AsyncIoGreenlet object at 0x7fd8d81e4040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8b1e340>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d82edb20>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d82edb20>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-323, stopped daemon 140567551530752)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef120>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d164ad40>, <coroutine object _run_coro_with_catch at 0x7fd8d164a840>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d164adc0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053082, self_id=507346814, post_type='message', sub_type='normal', user_id=2577117205, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8969ee0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8969e50>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d8969ee0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d81e4040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8969e50>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8969e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8969580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8969580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8969e50>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8969df0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8969d90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8969d90>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2577117205', 'time': datetime.datetime(2022, 3, 12, 2, 44, 42, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8969610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24b20>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8b8aa40>
           └ <_AsyncIoGreenlet object at 0x7fd8d81e4040 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8b1e340>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d82edb20>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d82edb20>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-323, stopped daemon 140567551530752)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d83afa30>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef120>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:44:42.000000', 'message', 'group', '-1427099327', '[{"type": "image", "data": {"file": "9fdb6c1f2c2cff5014fed3afa0fbca8c.image", "url": "https://gchat.qpic.cn/gchatpic_new/2577117205/962699166-3155042442-9FDB6C1F2C2CFF5014FED3AFA0FBCA8C/0?term=3", "subType": "1"}}]', '', '2577117205', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f40...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f40...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8452640>
           └ <_AsyncIoGreenlet object at 0x7fd8d16477d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d104d8c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f40...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d82ed030>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d82ed030>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-329, stopped daemon 140565982095104)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d153f8a0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fcae40>, <coroutine object _run_coro_with_catch at 0x7fd8d0fcaac0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0fca440>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053550, self_id=507346814, post_type='message', sub_type='normal', user_id=3531890582, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88f11f0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d88f1a90>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d88f11f0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d16477d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d88f1a90>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88f1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88f1cd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88f1cd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d88f1a90>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d88f1610>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88f1ca0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d88f1ca0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3531890582', 'time': datetime.datetime(2022, 3, 12, 2, 52, 30, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f12e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f40...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f40...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d8452640>
           └ <_AsyncIoGreenlet object at 0x7fd8d16477d0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d104d8c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f40...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d82ed030>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d82ed030>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-329, stopped daemon 140565982095104)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d97c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d153f8a0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:52:30.000000', 'message', 'group', '-1168290773', '[{"type": "image", "data": {"file": "2664c8ad2bd4f408f3bfa0749ca9c631.image", "url": "https://gchat.qpic.cn/gchatpic_new/3531890582/962699166-2378517162-2664C8AD2BD4F408F3BFA0749CA9C631/0?term=3", "subType": "0"}}]', '', '3531890582', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d104ddc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8ce01a0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d104d240>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4b90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4b90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-321, stopped daemon 140568273303296)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef8a0>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d961b840>, <coroutine object _run_coro_with_catch at 0x7fd8d836e7c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d85c71c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053002, self_id=507346814, post_type='message', sub_type='normal', user_id=3531890582, m...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0f5eca0>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d0f5eeb0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d0f5eca0>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8ce01a0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d0f5eeb0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0f5eeb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0f5e220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0f5e220>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d0f5eeb0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d0f5edc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0f5e880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d0f5e880>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '3531890582', 'time': datetime.datetime(2022, 3, 12, 2, 43, 22, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d0f5e4f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8a24880>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d104ddc0>
           └ <_AsyncIoGreenlet object at 0x7fd8d8ce01a0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d104d240>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4b90>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4b90>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-321, stopped daemon 140568273303296)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9d60>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d80ef8a0>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:43:22.000000', 'message', 'group', '-627391026', '[{"type": "image", "data": {"file": "6eb82bffc4316419b147bd4a47623bed.image", "url": "https://gchat.qpic.cn/gchatpic_new/3531890582/962699166-2619038822-6EB82BFFC4316419B147BD4A47623BED/0?term=3", "subType": "0"}}]', '', '3531890582', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd947273100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd947273100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd947273100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d882b3c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d86ebeb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16854c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4b20>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4b20>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-318, stopped daemon 140567929202432)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1120>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d889ebc0>, <coroutine object _run_coro_with_catch at 0x7fd8d17f90c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d84739c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052830, self_id=507346814, post_type='message', sub_type='normal', user_id=1981925360, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d87d0520>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d8411fa0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d87d0520>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d86ebeb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d8411fa0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8411fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8997340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8997340>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d8411fa0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d172ff70>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d172f370>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d172f370>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '1981925360', 'time': datetime.datetime(2022, 3, 12, 2, 40, 30, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d8cc2a30>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd947273100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd947273100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd947273100>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d882b3c0>
           └ <_AsyncIoGreenlet object at 0x7fd8d86ebeb0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d16854c0>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4b20>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4b20>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-318, stopped daemon 140567929202432)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d84d9880>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d8ba1120>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:40:30.000000', 'message', 'group', '109711244', '[{"type": "image", "data": {"file": "32812c784aedf2a71c4741749d0ba769.image", "url": "https://gchat.qpic.cn/gchatpic_new/1981925360/204222191-3099593500-32812C784AEDF2A71C4741749D0BA769/0?term=3", "subType": "0"}}]', '', '1981925360', '2222191')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebd...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebd...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d870fd40>
           └ <_AsyncIoGreenlet object at 0x7fd8d885ea90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8cb6a40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebd...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e898f0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e898f0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-301, stopped daemon 140566099592960)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e27a80>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d101e6c0>, <coroutine object _run_coro_with_catch at 0x7fd8d101ed40>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d82e2940>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647052588, self_id=507346814, post_type='message', sub_type='normal', user_id=963046537, me...
                 │    └ <function record_recv_msg at 0x7fd932837670>
                 └ <Dependent call=<function record_recv_msg at 0x7fd932837670>, params=[ModelField(name='event', type=MessageEvent, required=Tr...

  File "./src/plugins/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d86e6490>

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6c10>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d86e6490>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d885ea90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6c10>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6c10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d896b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d896b6a0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d86e6c10>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d86945e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8694fd0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d8694fd0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '963046537', 'time': datetime.datetime(2022, 3, 12, 2, 36, 28, tzinfo=datetime.timezone.utc), 'platform': 'qq', ...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d8843340>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d86947f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebd...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebd...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d1063400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d870fd40>
           └ <_AsyncIoGreenlet object at 0x7fd8d885ea90 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8cb6a40>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebd...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d0e898f0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d0e898f0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-301, stopped daemon 140566099592960)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d15fa400>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0e27a80>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:36:28.000000', 'message', 'group', '1109195583', '[{"type": "image", "data": {"file": "4e994f1332634ebdd46b4a939fd704e3.image", "url": "https://gchat.qpic.cn/gchatpic_new/963046537/937760225-3163171316-4E994F1332634EBDD46B4A939FD704E3/0?term=3", "subType": "1"}}]', '', '963046537', '937760225')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:21:15 | ERROR nonebot >> Error when running EventPostProcessors
Traceback (most recent call last):

  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d16ae240>
           └ <_AsyncIoGreenlet object at 0x7fd8d8c870f0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8760940>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4ab0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4ab0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-328, stopped daemon 140566594762496)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0f14030>)

sqlite3.OperationalError: database is locked


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 349, in handle_event
    await asyncio.gather(*coros)
          │       │       └ [<coroutine object _run_coro_with_catch at 0x7fd8d0fcac40>, <coroutine object _run_coro_with_catch at 0x7fd8d0fca2c0>]
          │       └ <function gather at 0x7fd94a03b0d0>
          └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 115, in _run_coro_with_catch
    return await coro
                 └ <coroutine object Dependent.__call__ at 0x7fd8d0fca0c0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'event': GroupMessageEvent(time=1647053478, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, m...
                 │    └ <function record_recv_msg at 0x7fd9272dbdc0>
                 └ <Dependent call=<function record_recv_msg at 0x7fd9272dbdc0>, params=[ModelField(name='event', type=MessageEvent, required=Tr...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot_plugin_chatrecorder/__init__.py", line 41, in record_recv_msg
    await session.commit()
          │       └ <function AsyncSession.commit at 0x7fd931ab2310>
          └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d95fe580>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/ext/asyncio/session.py", line 576, in commit
    return await greenlet_spawn(self.sync_session.commit)
                 │              │    │            └ <function Session.commit at 0x7fd931b35b80>
                 │              │    └ <sqlmodel.orm.session.Session object at 0x7fd8d95fedc0>
                 │              └ <sqlmodel.ext.asyncio.session.AsyncSession object at 0x7fd8d95fe580>
                 └ <function greenlet_spawn at 0x7fd9325c58b0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 136, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x7fd8d8c870f0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1431, in commit
    self._transaction.commit(_to_root=self.future)
    │    │                            │    └ True
    │    │                            └ <sqlmodel.orm.session.Session object at 0x7fd8d95fedc0>
    │    └ None
    └ <sqlmodel.orm.session.Session object at 0x7fd8d95fedc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x7fd931b34a60>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8953400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
    │    └ None
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d8953400>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3363, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x7fd931b399d0>
    └ <sqlmodel.orm.session.Session object at 0x7fd8d95fedc0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3503, in _flush
    transaction.rollback(_capture_exception=True)
    │           └ <function SessionTransaction.rollback at 0x7fd931b34b80>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x7fd8d83955e0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 70, in __exit__
    compat.raise_(
    │      └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util.compat' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 3463, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x7fd931b2f1f0>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d821c9d0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fd8d821c9d0>
    │   └ <function SaveUpdateAll.execute at 0x7fd931b2faf0>
    └ SaveUpdateAll(mapped class MessageRecord->chatrecorder_message_record)
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 630, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x7fd931b1f040>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py'>
    │    └ <sqlalchemy.util._preloaded._ModuleRegistry object at 0x7fd932852f70>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 244, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x7fd931b1f670>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 1221, in _emit_insert_statements
    result = connection._execute_20(
             │          └ <function Connection._execute_20 at 0x7fd9320285e0>
             └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1614, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ {'compiled_cache': {(<sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>, ('0', <class 's...
           │    │     │             └ immutabledict({})
           │    │     └ ({'user_id': '2560359315', 'time': datetime.datetime(2022, 3, 12, 2, 51, 18, tzinfo=datetime.timezone.utc), 'platform': 'qq',...
           │    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x7fd8d84de6d0>>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 325, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fd932028430>
           └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1481, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fd932028700>
          └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1845, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fd9320288b0>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2026, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fd932806820>
    └ <module 'sqlalchemy.util' from '/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1802, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fd931d67940>
    │    └ <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7fd9328c6d90>
    └ <sqlalchemy.future.engine.Connection object at 0x7fd8d88f17f0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 732, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7...
    │      │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │      └ <function AsyncAdapt_aiosqlite_cursor.execute at 0x7fd93150ed30>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 100, in execute
    self._adapt_connection._handle_exception(error)
    │    └ <member '_adapt_connection' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 229, in _handle_exception
    raise error
          └ OperationalError('database is locked')
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 82, in execute
    self.await_(_cursor.execute(operation, parameters))
    │    │      │       │       │          └ ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7...
    │    │      │       │       └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
    │    │      │       └ <function Cursor.execute at 0x7fd93149c940>
    │    │      └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
    │    └ <member 'await_' of 'AsyncAdapt_aiosqlite_cursor' objects>
    └ <sqlalchemy.dialects.sqlite.aiosqlite.AsyncAdapt_aiosqlite_cursor object at 0x7fd8d8dae4c0>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 76, in await_only
    return current.driver.switch(awaitable)
           │                     └ <coroutine object Cursor.execute at 0x7fd8d16ae240>
           └ <_AsyncIoGreenlet object at 0x7fd8d8c870f0 (otid=0x7fd9501fc380) dead>
  File "/usr/local/python3/lib/python3.8/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 129, in greenlet_spawn
    value = await result
                  └ <coroutine object Connection.rollback at 0x7fd8d8760940>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 37, in execute
    await self._execute(self._cursor.execute, sql, parameters)
          │    │        │    │       │        │    └ ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7...
          │    │        │    │       │        └ 'INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group...
          │    │        │    │       └ <method 'execute' of 'sqlite3.Cursor' objects>
          │    │        │    └ <sqlite3.Cursor object at 0x7fd8d89b4ab0>
          │    │        └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
          │    └ <function Cursor._execute at 0x7fd93149c8b0>
          └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/cursor.py", line 31, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
                 │    │     │        │    │       └ {}
                 │    │     │        │    └ ('INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, grou...
                 │    │     │        └ <built-in method execute of sqlite3.Cursor object at 0x7fd8d89b4ab0>
                 │    │     └ <function Connection._execute at 0x7fd9314ac8b0>
                 │    └ <Connection(Thread-328, stopped daemon 140566594762496)>
                 └ <aiosqlite.cursor.Cursor object at 0x7fd8d8694f70>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 129, in _execute
    return await future
                 └ <Future finished exception=OperationalError('database is locked')>
  File "/usr/local/python3/lib/python3.8/site-packages/aiosqlite/core.py", line 102, in run
    result = function()
             └ functools.partial(<built-in method close of sqlite3.Connection object at 0x7fd8d0f14030>)

sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO chatrecorder_message_record (platform, time, type, detail_type, message_id, message, alt_message, user_id, group_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('qq', '2022-03-12 02:51:18.000000', 'message', 'group', '-849707843', '[{"type": "image", "data": {"file": "8595f73f4b4db8b7f0bb083f0d751db4.image", "url": "https://gchat.qpic.cn/gchatpic_new/2560359315/962699166-3219757331-8595F73F4B4DB8B7F0BB083F0D751DB4/0?term=3", "subType": "1"}}]', '', '2560359315', '962699166')]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
[36mATRI[0m | 03-12 11:22:38 | ERROR nonebot >> Running matcher <Matcher from src.plugins.ping, type=message, priority=1, temp=False> failed.
Traceback (most recent call last):

  File "/usr/bin/nb", line 8, in <module>
    sys.exit(main())
    │   │    └ <ClickAliasedGroup main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function BaseCommand.main at 0x7fd94f977040>
           └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0x7fd9501fd4f0>
         │    └ <function MultiCommand.invoke at 0x7fd94f97b0d0>
         └ <ClickAliasedGroup main>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
           │               │       │       │      └ <click.core.Context object at 0x7fd957aea370>
           │               │       │       └ <function Command.invoke at 0x7fd94f977af0>
           │               │       └ <ClickAliasedCommand run>
           │               └ <click.core.Context object at 0x7fd957aea370>
           └ <function MultiCommand.invoke.<locals>._process_result at 0x7fd9468a2a60>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'file': 'bot.py', 'app': 'app'}
           │   │      │    │           └ <click.core.Context object at 0x7fd957aea370>
           │   │      │    └ <function run at 0x7fd9469ce940>
           │   │      └ <ClickAliasedCommand run>
           │   └ <function Context.invoke at 0x7fd94f9738b0>
           └ <click.core.Context object at 0x7fd957aea370>
  File "/usr/local/python3/lib/python3.8/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
                       │       └ {'file': 'bot.py', 'app': 'app'}
                       └ ()
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/commands/main.py", line 30, in run
    run_bot(file, app)
    │       │     └ 'app'
    │       └ 'bot.py'
    └ <function run_bot at 0x7fd9469be700>
  File "/usr/local/python3/lib/python3.8/site-packages/nb_cli/handlers/deploy.py", line 24, in run_bot
    nonebot.run(app=f"{module_name}:{app}")
    │       └ <function run at 0x7fd948ac39d0>
    └ <module 'nonebot' from '/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/__init__.py", line 258, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {'app': 'bot:app'}
    │                 └ ()
    └ <function get_driver at 0x7fd948ac3550>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/drivers/fastapi.py", line 168, in run
    uvicorn.run(
    │       └ <function run at 0x7fd9467ca700>
    └ <module 'uvicorn' from '/usr/local/python3/lib/python3.8/site-packages/uvicorn/__init__.py'>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/main.py", line 463, in run
    server.run()
    │      └ <function Server.run at 0x7fd9467caaf0>
    └ <uvicorn.server.Server object at 0x7fd8db3355b0>
  File "/usr/local/python3/lib/python3.8/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x7fd9467cab80>
           │       │   └ <uvicorn.server.Server object at 0x7fd8db3355b0>
           │       └ <function run at 0x7fd94c1ff4c0>
           └ <module 'asyncio' from '/usr/local/python3/lib/python3.8/asyncio/__init__.py'>
  File "/usr/local/python3/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd8db3424c0>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 153, in _check_matcher
    await _run_matcher(Matcher, bot, event, state, stack, dependency_cache)
          │            │        │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-72699' coro=<_event_to_me() done, defined at /usr/local...
          │            │        │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8d13520>
          │            │        │    │      └ {'_prefix': {'command': ('ping',), 'raw_command': '/ping', 'command_arg': []}}
          │            │        │    └ GroupMessageEvent(time=1647055353, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
          │            │        └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │            └ <Matcher from src.plugins.ping, type=message, priority=1, temp=False>
          └ <function _run_matcher at 0x7fd9468e3700>
> File "/usr/local/python3/lib/python3.8/site-packages/nonebot/message.py", line 202, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-72699' coro=<_event_to_me() done, defined at /usr/local...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8d13520>
          │       │   │    │      └ {'_prefix': {'command': ('ping',), 'raw_command': '/ping', 'command_arg': []}}
          │       │   │    └ GroupMessageEvent(time=1647055353, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
          │       │   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │       └ <function Matcher.run at 0x7fd948ae3c10>
          └ <Matcher from src.plugins.ping, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 668, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function _event_to_me at 0x7fd948a670d0>: <Task finished name='Task-72699' coro=<_event_to_me() done, defined at /usr/local...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x7fd8d8d13520>
          │    │          │    │      └ {'_prefix': {'command': ('ping',), 'raw_command': '/ping', 'command_arg': []}}
          │    │          │    └ GroupMessageEvent(time=1647055353, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
          │    │          └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
          │    └ <function Matcher.simple_run at 0x7fd948ae3b80>
          └ <Matcher from src.plugins.ping, type=message, priority=1, temp=False>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 635, in simple_run
    await handler(
          └ <Dependent call=<function ping_handle at 0x7fd8db4e18b0>, params=[ModelField(name='bot', type=Bot, required=True), ModelField...
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/dependencies/__init__.py", line 92, in __call__
    return await self.call(**values)
                 │    │      └ {'bot': <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>, 'event': GroupMessageEvent(time=1647055353, self_id=5...
                 │    └ <function ping_handle at 0x7fd8db4e18b0>
                 └ <Dependent call=<function ping_handle at 0x7fd8db4e18b0>, params=[ModelField(name='bot', type=Bot, required=True), ModelField...

  File "./src/plugins/ping.py", line 15, in ping_handle
    await ping.send(result)
          │    │    └ 'Pong!   (520 ms)'
          │    └ <classmethod object at 0x7fd948adebe0>
          └ <Matcher from src.plugins.ping, type=message, priority=1, temp=False>

  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/matcher.py", line 449, in send
    return await bot.send(event=event, message=_message, **kwargs)
                 │   │          │              │           └ {}
                 │   │          │              └ 'Pong!   (520 ms)'
                 │   │          └ GroupMessageEvent(time=1647055353, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
                 │   └ <function Bot.send at 0x7fd9468e3c10>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 247, in send
    return await self.__class__.send_handler(self, event, message, **kwargs)
                 │    │                      │     │      │          └ {}
                 │    │                      │     │      └ 'Pong!   (520 ms)'
                 │    │                      │     └ GroupMessageEvent(time=1647055353, self_id=507346814, post_type='message', sub_type='normal', user_id=2560359315, message_typ...
                 │    │                      └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                 │    └ <attribute '__class__' of 'object' objects>
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 175, in send
    return await bot.send_msg(**params)
                 │              └ {'user_id': 2560359315, 'group_id': 277620613, 'message_type': 'group', 'message': [MessageSegment(type='text', data={'text':...
                 └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/bot.py", line 208, in call_api
    return await super().call_api(api, **data)
                                  │      └ {'user_id': 2560359315, 'group_id': 277620613, 'message_type': 'group', 'message': [MessageSegment(type='text', data={'text':...
                                  └ 'send_msg'
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 117, in call_api
    raise exception
          └ <ActionFailed data=None, echo={'seq': 19}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/internal/adapter/bot.py", line 94, in call_api
    result = await self.adapter._call_api(self, api, **data)
                   │    │       │         │     │      └ {'user_id': 2560359315, 'group_id': 277620613, 'message_type': 'group', 'message': [MessageSegment(type='text', data={'text':...
                   │    │       │         │     └ 'send_msg'
                   │    │       │         └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
                   │    │       └ <function Adapter._call_api at 0x7fd9468f1040>
                   │    └ <nonebot.adapters.onebot.v11.adapter.Adapter object at 0x7fd9469d3a30>
                   └ <nonebot.adapters.onebot.v11.bot.Bot object at 0x7fd8da69d9a0>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/adapter.py", line 107, in _call_api
    return _handle_api_result(
           └ <function _handle_api_result at 0x7fd946977670>
  File "/usr/local/python3/lib/python3.8/site-packages/nonebot/adapters/onebot/v11/utils.py", line 81, in _handle_api_result
    raise ActionFailed(**result)
          │              └ {'data': None, 'echo': {'seq': 19}, 'msg': 'SEND_MSG_API_ERROR', 'retcode': 100, 'status': 'failed', 'wording': '请参考 go-cqhtt...
          └ <class 'nonebot.adapters.onebot.v11.exception.ActionFailed'>

nonebot.adapters.onebot.v11.exception.ActionFailed: <ActionFailed data=None, echo={'seq': 19}, msg=SEND_MSG_API_ERROR, retcode=100, status=failed, wording=请参考 go-cqhttp 端输出>
[36mATRI[0m | 03-12 11:22:53 | WARNING nonebot >> OneBot V11 | WebSocket for Bot 507346814 closed by peer
[36mATRI[0m | 03-12 11:24:08 | WARNING nonebot >> OneBot V11 | WebSocket for Bot 507346814 closed by peer
